apiVersion: v1
kind: ConfigMap
metadata:
  name: superset-config
  namespace: mrhealth-db
data:
  superset_config.py: |
    import os
    
    # Security
    SECRET_KEY = os.environ.get('SUPERSET_SECRET_KEY', 'mrhealth-superset-default-key')
    
    # Database
    SQLALCHEMY_DATABASE_URI = 'sqlite:////app/superset_home/superset.db'
    
    # Feature flags
    FEATURE_FLAGS = {
        "ENABLE_TEMPLATE_PROCESSING": True,
    }

    # === FIX ERRO 1035: Disable async queries (no Celery/Redis) ===
    GLOBAL_ASYNC_QUERIES = False
    SQLLAB_ASYNC_TIME_LIMIT_SEC = 0
    RESULTS_BACKEND = None

    # Increase timeouts for sync queries
    SUPERSET_WEBSERVER_TIMEOUT = 300
    SQLLAB_TIMEOUT = 300
    SQL_MAX_ROW = 100000

    # BigQuery connection (via authorized_user)
    GOOGLE_APPLICATION_CREDENTIALS = '/app/keys/gcp.json'
